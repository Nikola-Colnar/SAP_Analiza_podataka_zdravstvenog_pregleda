---
title: "R Notebook"
output: pdf_document
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}
library(dplyr)

# Učitavanje podataka iz csv datoteke:
healthDATA.modif = read.csv("Health Screening Data.csv")
View(healthDATA.modif)

```



Podjela na dvi tablice za aktivne i neaktivne
```{r}

library(dplyr)


# Funkcija za uklanjanje outliera
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower <- Q1 - 1.5 * IQR
  upper <- Q3 + 1.5 * IQR
  x[x >= lower & x <= upper]
}

# Filtriranje podataka za ap_lo i ap_hi:
healthDATA.filtered <- healthDATA.modif %>%
  group_by(BMICat) %>%
  filter(ap_lo >= quantile(ap_lo, 0.25) - 1.5 * IQR(ap_lo) & 
           ap_lo <= quantile(ap_lo, 0.75) + 1.5 * IQR(ap_lo)) %>%
  filter(ap_hi >= quantile(ap_hi, 0.25) - 1.5 * IQR(ap_hi) & 
           ap_hi <= quantile(ap_hi, 0.75) + 1.5 * IQR(ap_hi))


# Generiranje box plotova bez outliera:
boxplot(ap_lo ~ BMICat, 
        data = healthDATA.filtered,
        main = "Box Plot za ap_lo prema BMI kategorijama (bez outliera u podacima)",
        xlab = "BMI Kategorije",
        ylab = "ap_lo",
        col = "lightblue")

boxplot(ap_hi ~ BMICat, 
        data = healthDATA.filtered,
        main = "Box Plot za ap_hi prema BMI kategorijama (bez outliera u podacima)",
        xlab = "BMI Kategorije",
        ylab = "ap_hi",
        col = "lightgreen")

```


prosjecne vrijedosti po tablici
```{r}
library(dplyr)
library(ggplot2)

# Filtriranje podataka za kategoriju "Overweight":
overweight_data <- healthDATA.modif %>%
  filter(BMICat == "Over Weight")

# Histogram distribucije ap_hi za Overweight:
ggplot(overweight_data, aes(x = ap_hi)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribucija višeg tlaka (ap_hi) za Overweight",
       x = "Visoki tlak (ap_hi)",
       y = "Frekvencija") +
  theme_minimal()

# Density graf distribucije ap_hi za Overweight:
ggplot(overweight_data, aes(x = ap_hi)) +
  geom_density(fill = "lightgreen", alpha = 0.7) +
  labs(title = "Gustoća distribucije višeg tlaka (ap_hi) za Overweight",
       x = "Visoki tlak (ap_hi)",
       y = "Gustoća") +
  theme_minimal()



```

```{r}
library(dplyr)

# Filtriranje podataka za kategoriju "Overweight":
overweight_data <- healthDATA.modif %>%
  filter(BMICat == "Over Weight")

# Izračun kvartila za ap_hi:
quartiles <- quantile(overweight_data$ap_hi, probs = c(0.25, 0.5, 0.75, 1.0), na.rm = TRUE)

# Ispis rezultata:
print(quartiles)

```



```{r}
library(dplyr)

# Funkcija za uklanjanje outliera:
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower <- Q1 - 1.5 * IQR
  upper <- Q3 + 1.5 * IQR
  return(x[x >= lower & x <= upper])
}

# Filtriranje podataka za kategoriju "Overweight":
overweight_data <- healthDATA.modif %>%
  filter(BMICat == "Over Weight")

# Uklanjanje outliera iz ap_hi:
filtered_ap_hi <- remove_outliers(overweight_data$ap_hi)

# Tablica frekvencija za ap_hi bez outliera:
freq_table <- as.data.frame(table(filtered_ap_hi))

# Dodavanje naziva stupaca:
colnames(freq_table) <- c("Vrijednost_ap_hi", "Frekvencija")

# Ispis tablice frekvencija:
print(freq_table)

```

```{r}

library(dplyr)

# Izračun srednje vrijednosti za sve podatke (sve BMI grupe zajedno) za ap_hi i ap_lo:
srednja_sve <- healthDATA.modif %>%
  summarise(Srednja_ap_hi = mean(ap_hi, na.rm = TRUE),
            Srednja_ap_lo = mean(ap_lo, na.rm = TRUE))

# Izračun srednje vrijednosti za svaku BMI grupu odvojeno za ap_hi i ap_lo:
srednja_po_grupama <- healthDATA.modif %>%
  group_by(BMICat) %>%
  summarise(Srednja_ap_hi = mean(ap_hi, na.rm = TRUE),
            Srednja_ap_lo = mean(ap_lo, na.rm = TRUE))

# Ispis rezultata:
cat("Srednje vrijednosti za sve BMI grupe zajedno:\n")
print(srednja_sve)

cat("\nSrednje vrijednosti za svaku BMI grupu odvojeno:\n")
print(srednja_po_grupama)



```
```{r}
library(dplyr)

# Provjera veličine svake BMI grupe
velicine_grupa <- healthDATA.modif %>%
  group_by(BMICat) %>%
  summarise(Velicina = n())

cat("Veličine BMI grupa:\n")
print(velicine_grupa)

# Kolmogorov-Smirnov test za normalnost za svaku grupu i za ap_hi i ap_lo
ks_test_rezultati <- healthDATA.modif %>%
  group_by(BMICat) %>%
  summarise(
    KS_ap_hi_stat = ks.test(ap_hi, "pnorm", mean(ap_hi, na.rm = TRUE), sd(ap_hi, na.rm = TRUE))$statistic,
    KS_ap_hi_pval = ks.test(ap_hi, "pnorm", mean(ap_hi, na.rm = TRUE), sd(ap_hi, na.rm = TRUE))$p.value,
    KS_ap_lo_stat = ks.test(ap_lo, "pnorm", mean(ap_lo, na.rm = TRUE), sd(ap_lo, na.rm = TRUE))$statistic,
    KS_ap_lo_pval = ks.test(ap_lo, "pnorm", mean(ap_lo, na.rm = TRUE), sd(ap_lo, na.rm = TRUE))$p.value
  )

cat("\nKolmogorov-Smirnov test rezultati:\n")
print(ks_test_rezultati)

```


```{r}

library(dplyr)
library(ggplot2)

# Funkcija za uklanjanje outliera:
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower <- Q1 - 1.5 * IQR
  upper <- Q3 + 1.5 * IQR
  return(ifelse(x >= lower & x <= upper, x, NA))
}

# Uklanjanje outliera za ap_hi i ap_lo:
filtered_data <- healthDATA.modif %>%
  group_by(BMICat) %>%
  mutate(ap_hi_filtered = remove_outliers(ap_hi),
         ap_lo_filtered = remove_outliers(ap_lo)) %>%
  ungroup()

# Priprema podataka za grafove:
ap_hi_data <- filtered_data %>%
  select(BMICat, ap_hi_filtered) %>%
  rename(Value = ap_hi_filtered) %>%
  mutate(Variable = "ap_hi")

ap_lo_data <- filtered_data %>%
  select(BMICat, ap_lo_filtered) %>%
  rename(Value = ap_lo_filtered) %>%
  mutate(Variable = "ap_lo")

# Kombiniranje podataka:
plot_data <- bind_rows(ap_hi_data, ap_lo_data)

# Kreiranje histogram grafova s facet_wrap:
ggplot(plot_data, aes(x = Value, fill = BMICat)) +
  geom_histogram(binwidth = 6, color = "black", alpha = 0.7, position = "dodge") +
  facet_wrap(~ Variable + BMICat, scales = "free", ncol = 2) +
  labs(title = "Histogrami ap_hi i ap_lo prema BMI kategorijama (bez outliera)",
       x = "Vrijednost",
       y = "Frekvencija") +
  theme_minimal() +
  theme(legend.position = "bottom")


```


```{r}


library(dplyr)
library(ggplot2)

# Funkcija za zaokruživanje na najbliži višekratnik 5:
round_to_nearest_5 <- function(x) {
  round(x / 10) * 10
}

# Funkcija za uklanjanje outliera:
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower <- Q1 - 1.5 * IQR
  upper <- Q3 + 1.5 * IQR
  return(ifelse(x >= lower & x <= upper, x, NA))
}

# Uklanjanje outliera i zaokruživanje:
filtered_data <- healthDATA.modif %>%
  group_by(BMICat) %>%
  mutate(
    ap_hi = remove_outliers(ap_hi), # Ukloni outliere za ap_hi
    ap_lo = remove_outliers(ap_lo), # Ukloni outliere za ap_lo
    ap_hi = round_to_nearest_5(ap_hi), # Zaokruži na 5
    ap_lo = round_to_nearest_5(ap_lo)  # Zaokruži na 5
  ) %>%
  ungroup()

# Histogrami za ap_hi:
hist_ap_hi <- ggplot(filtered_data, aes(x = ap_hi)) +
  geom_histogram(binwidth = 5, color = "black", fill = "lightblue", alpha = 0.7) +
  facet_wrap(~ BMICat, scales = "free_y", ncol = 2) +
  labs(title = "Histograms for ap_hi (Rounded, Outliers Removed)",
       x = "ap_hi (Rounded to 5)",
       y = "Frequency") +
  theme_minimal()

# Histogrami za ap_lo:
hist_ap_lo <- ggplot(filtered_data, aes(x = ap_lo)) +
  geom_histogram(binwidth = 5, color = "black", fill = "lightgreen", alpha = 0.7) +
  facet_wrap(~ BMICat, scales = "free_y", ncol = 2) +
  labs(title = "Histograms for ap_lo (Rounded, Outliers Removed)",
       x = "ap_lo (Rounded to 5)",
       y = "Frequency") +
  theme_minimal()

# Q-Q grafovi za ap_hi:
qq_ap_hi <- ggplot(filtered_data, aes(sample = ap_hi)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~ BMICat, scales = "free", ncol = 2) +
  labs(title = "Q-Q Plots for ap_hi (Rounded, Outliers Removed)",
       x = "Theoretical Quantiles",
       y = "Sample Quantiles") +
  theme_minimal()

# Q-Q grafovi za ap_lo:
qq_ap_lo <- ggplot(filtered_data, aes(sample = ap_lo)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~ BMICat, scales = "free", ncol = 2) +
  labs(title = "Q-Q Plots for ap_lo (Rounded, Outliers Removed)",
       x = "Theoretical Quantiles",
       y = "Sample Quantiles") +
  theme_minimal()

# Prikaz svih grafova:
print(hist_ap_hi)
print(hist_ap_lo)
print(qq_ap_hi)
print(qq_ap_lo)





```


```{r}

library(dplyr)
library(ggplot2)

# Funkcija za zaokruživanje na najbliži višekratnik 10:
round_to_nearest_10 <- function(x) {
  round(x / 10) * 10
}

# Funkcija za uklanjanje outliera:
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower <- Q1 - 1.5 * IQR
  upper <- Q3 + 1.5 * IQR
  return(ifelse(x >= lower & x <= upper, x, NA))
}

# Uklanjanje outliera i zaokruživanje na 10:
filtered_data <- healthDATA.modif %>%
  group_by(BMICat) %>%
  mutate(
    ap_hi = remove_outliers(ap_hi), # Ukloni outliere za ap_hi
    ap_lo = remove_outliers(ap_lo), # Ukloni outliere za ap_lo
    ap_hi = round_to_nearest_10(ap_hi), # Zaokruži na 10
    ap_lo = round_to_nearest_10(ap_lo)  # Zaokruži na 10
  ) %>%
  ungroup()

# Provjera normalnosti za diskretne vrijednosti:
ks_results_rounded_10 <- filtered_data %>%
  group_by(BMICat) %>%
  summarise(
    KS_ap_hi_stat = ks.test(ap_hi, "pnorm", mean(ap_hi, na.rm = TRUE), sd(ap_hi, na.rm = TRUE))$statistic,
    KS_ap_hi_pval = ks.test(ap_hi, "pnorm", mean(ap_hi, na.rm = TRUE), sd(ap_hi, na.rm = TRUE))$p.value,
    KS_ap_lo_stat = ks.test(ap_lo, "pnorm", mean(ap_lo, na.rm = TRUE), sd(ap_lo, na.rm = TRUE))$statistic,
    KS_ap_lo_pval = ks.test(ap_lo, "pnorm", mean(ap_lo, na.rm = TRUE), sd(ap_lo, na.rm = TRUE))$p.value
  )

# Histogrami za ap_hi i ap_lo:
hist_ap_hi_10 <- ggplot(filtered_data, aes(x = ap_hi, fill = BMICat)) +
  geom_histogram(binwidth = 10, color = "black", alpha = 0.7, position = "dodge") +
  labs(title = "Histogram za ap_hi (zaokruženo na 10, bez outliera)",
       x = "ap_hi (zaokruženo na 10)",
       y = "Frekvencija") +
  theme_minimal()

hist_ap_lo_10 <- ggplot(filtered_data, aes(x = ap_lo, fill = BMICat)) +
  geom_histogram(binwidth = 10, color = "black", alpha = 0.7, position = "dodge") +
  labs(title = "Histogram za ap_lo (zaokruženo na 10, bez outliera)",
       x = "ap_lo (zaokruženo na 10)",
       y = "Frekvencija") +
  theme_minimal()

# Prikaz rezultata Kolmogorov-Smirnovog testa:
cat("\nKolmogorov-Smirnov test za normalnost (zaokružene varijable na 10, bez outliera):\n")
print(ks_results_rounded_10)

# Prikaz histogram grafova:
print(hist_ap_hi_10)
print(hist_ap_lo_10)


```

```{r}



library(car) # Za Leveneov test

# Leveneov test za ap_hi:
levene_ap_hi <- leveneTest(ap_hi ~ BMICat, data = filtered_data, na.action = na.exclude)

# Leveneov test za ap_lo:
levene_ap_lo <- leveneTest(ap_lo ~ BMICat, data = filtered_data, na.action = na.exclude)

# Prikaz rezultata:
cat("Rezultati Leveneovog testa za ap_hi:\n")
print(levene_ap_hi)

cat("\nRezultati Leveneovog testa za ap_lo:\n")
print(levene_ap_lo)

```

