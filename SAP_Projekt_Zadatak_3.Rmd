---
title: "R Notebook"
output: pdf_document
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}
library(dplyr)
library(ggplot2)
library(car)
library(nortest)

# Učitavanje podataka iz csv datoteke:
healthDATA.modif = read.csv("Health Screening Data.csv")
View(healthDATA.modif)

```



Čišćenje podataka


```{r}
# Postavljanje granica za krvni tlak
ap_hi_min <- 80
ap_hi_max <- 250
ap_lo_min <- 40
ap_lo_max <- 150

# Postavljanje realnih granica za BMI
bmi_min <- 10
bmi_max <- 60

# Čišćenje podataka
healthDATA.clean <- healthDATA.modif %>%
  filter(ap_hi >= ap_hi_min & ap_hi <= ap_hi_max) %>%
  filter(ap_lo >= ap_lo_min & ap_lo <= ap_lo_max) %>%
  filter(ap_lo <= ap_hi) %>%
  filter(BMI >= bmi_min & BMI <= bmi_max)

# Prikaz očišćenih podataka
View(healthDATA.clean)

```


```{r}

# Histogram za sistolički tlak (ap_hi)
ggplot(healthDATA.clean, aes(x = ap_hi)) +
  geom_histogram(binwidth = 10, fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Distribucija sistoličkog tlaka", x = "Sistolicki tlak (ap_hi)", y = "Frekvencija") +
  theme_minimal()

# Histogram za dijastolički tlak (ap_lo)
ggplot(healthDATA.clean, aes(x = ap_lo)) +
  geom_histogram(binwidth = 10, fill = "red", color = "black", alpha = 0.7) +
  labs(title = "Distribucija dijastoličkog tlaka", x = "Dijastolički tlak (ap_lo)", y = "Frekvencija") +
  theme_minimal()

```


```{r}
library(ggplot2)
library(dplyr)

# Lista jedinstvenih BMI kategorija
bmi_categories <- unique(healthDATA.clean$BMICat)

# Kreiranje histograma i QQ plotova za svaku BMI kategoriju
for (bmi_cat in bmi_categories) {
  
  # Filtriranje podataka za trenutnu BMI kategoriju
  data_subset <- healthDATA.clean %>% filter(BMICat == bmi_cat)
  
  # Histogram za sistolički tlak (ap_hi)
  p1 <- ggplot(data_subset, aes(x = ap_hi)) +
    geom_histogram(binwidth = 10, fill = "blue", color = "black", alpha = 0.7) +
    labs(title = paste("Distribucija sistoličkog tlaka -", bmi_cat),
         x = "Sistolicki tlak (ap_hi)", y = "Frekvencija") +
    theme_minimal()
  
  # Histogram za dijastolički tlak (ap_lo)
  p2 <- ggplot(data_subset, aes(x = ap_lo)) +
    geom_histogram(binwidth = 10, fill = "red", color = "black", alpha = 0.7) +
    labs(title = paste("Distribucija dijastoličkog tlaka -", bmi_cat),
         x = "Dijastolički tlak (ap_lo)", y = "Frekvencija") +
    theme_minimal()
  
  # QQ plot za sistolički tlak (ap_hi)
  p3 <- ggplot(data_subset, aes(sample = ap_hi)) +
    stat_qq(color = "blue") +
    stat_qq_line(color = "red") +
    labs(
      title = paste("Q-Q plot - Sistolicki tlak (ap_hi) -", bmi_cat),
      x = "Teorijske kvantile",
      y = "Empirijske kvantile"
    ) +
    theme_minimal()
  
  # QQ plot za dijastolički tlak (ap_lo)
  p4 <- ggplot(data_subset, aes(sample = ap_lo)) +
    stat_qq(color = "blue") +
    stat_qq_line(color = "red") +
    labs(
      title = paste("Q-Q plot - Dijastolički tlak (ap_lo) -", bmi_cat),
      x = "Teorijske kvantile",
      y = "Empirijske kvantile"
    ) +
    theme_minimal()
  
  # Prikaz grafova
  print(p1)
  print(p2)
  print(p3)
  print(p4)
}

}
```


```{r}
# Potrebne biblioteke
library(dplyr)
library(car)  # za Leveneov test

# Pretpostavimo da ste podatke već učitali u healthDATA.clean

# 1) Test normalnosti po grupama (Kolmogorov-Smirnov)
bmi_categories <- unique(healthDATA.clean$BMICat)

for (bmi_cat in bmi_categories) {
  
  data_subset <- healthDATA.clean %>%
    filter(BMICat == bmi_cat)
  
  cat("==================================================\n")
  cat("BMI Category:", bmi_cat, "\n")
  cat("Broj zapisa u ovoj kategoriji:", nrow(data_subset), "\n")
  
  # Kolmogorov–Smirnov test za ap_hi
  ks_hi <- ks.test(
    data_subset$ap_hi, 
    "pnorm",
    mean = mean(data_subset$ap_hi), 
    sd   = sd(data_subset$ap_hi)
  )
  cat("\n>> Kolmogorov-Smirnov test - ap_hi <<\n")
  cat("  p-value:", ks_hi$p.value, "\n")
  
  # Kolmogorov–Smirnov test za ap_lo
  ks_lo <- ks.test(
    data_subset$ap_lo, 
    "pnorm",
    mean = mean(data_subset$ap_lo), 
    sd   = sd(data_subset$ap_lo)
  )
  cat("\n>> Kolmogorov-Smirnov test - ap_lo <<\n")
  cat("  p-value:", ks_lo$p.value, "\n\n")
}

cat("==================================================\n")
cat("     Test homoskedasticnosti (LeveneTest)\n")
cat("==================================================\n")

# 2) Leveneov test homoskedastičnosti između svih BMI grupa
#    - za ap_hi
levene_hi <- leveneTest(ap_hi ~ BMICat, data = healthDATA.clean)
cat("\nLevene test: ap_hi ~ BMICat\n")
print(levene_hi)

#    - za ap_lo
levene_lo <- leveneTest(ap_lo ~ BMICat, data = healthDATA.clean)
cat("\nLevene test: ap_lo ~ BMICat\n")
print(levene_lo)


```

```{r}

# Kruskal-Wallis za sistolički tlak (ap_hi)
kruskal_hi <- kruskal.test(ap_hi ~ BMICat, data = healthDATA.clean)
cat("----- Kruskal-Wallis Test za ap_hi -----\n")
print(kruskal_hi)

# Kruskal-Wallis za dijastolički tlak (ap_lo)
kruskal_lo <- kruskal.test(ap_lo ~ BMICat, data = healthDATA.clean)
cat("\n----- Kruskal-Wallis Test za ap_lo -----\n")
print(kruskal_lo)

```
```{r}
library(FSA)  # za dunnTest

# Post-hoc (Dunn test) za ap_hi
cat("\n===== POST-HOC: Dunn test za ap_hi =====\n")
dunn_hi <- dunnTest(ap_hi ~ BMICat, data = healthDATA.clean, method = "bonferroni")
print(dunn_hi)

# Post-hoc (Dunn test) za ap_lo
cat("\n===== POST-HOC: Dunn test za ap_lo =====\n")
dunn_lo <- dunnTest(ap_lo ~ BMICat, data = healthDATA.clean, method = "bonferroni")
print(dunn_lo)
```



```{r}


# Boxplot za sistolički tlak (ap_hi) po BMI kategorijama
p_hi <- ggplot(healthDATA.clean, aes(x = BMICat, y = ap_hi)) + 
  geom_boxplot(fill = "skyblue", alpha = 0.7, outlier.color = "red") +
  # Crvena isprekidana linija je ukupna sredina (mean) ap_hi
  geom_hline(yintercept = mean(healthDATA.clean$ap_hi), 
             color = "red", linetype = "dashed", size = 1) +
  labs(title = "Box plot sistoličkog tlaka (ap_hi) po BMI kategorijama", 
       x = "BMI kategorija", 
       y = "Sistolički tlak (ap_hi)") +
  theme_minimal()

# Boxplot za dijastolički tlak (ap_lo) po BMI kategorijama
p_lo <- ggplot(healthDATA.clean, aes(x = BMICat, y = ap_lo)) + 
  geom_boxplot(fill = "orange", alpha = 0.7, outlier.color = "blue") +
  # Crvena isprekidana linija je ukupna sredina (mean) ap_lo
  geom_hline(yintercept = mean(healthDATA.clean$ap_lo), 
             color = "red", linetype = "dashed", size = 1) +
  labs(title = "Box plot dijastoličkog tlaka (ap_lo) po BMI kategorijama", 
       x = "BMI kategorija", 
       y = "Dijastolički tlak (ap_lo)") +
  theme_minimal()

# Prikaz oba grafa
print(p_hi)
print(p_lo)



```

